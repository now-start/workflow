name: Reusable Java Build and Deploy (Legacy Wrapper)

on:
  workflow_call:
    inputs:
      service-name:
        description: 'Service name for Docker image tagging'
        required: false
        type: string
        default: '${{ github.event.repository.name }}'
      registry-org:
        description: 'Registry organization/namespace (e.g., ghcr.io/now-start)'
        required: false
        type: string
        default: 'ghcr.io/now-start'
      environment:
        description: 'Deployment environment (e.g., prd, dev)'
        required: false
        type: string
        default: 'prd'
    secrets:
      registry-password:
        description: 'Registry password/token'
        required: true

jobs:
  prepare:
    uses: now-start/workflow/.github/workflows/reusable-java-prepare.yaml@main
    with:
      environment: ${{ inputs.environment }}

  build:
    needs: prepare
    if: ${{ needs.prepare.outputs.should-skip == 'false' }}
    uses: now-start/workflow/.github/workflows/reusable-java-test.yaml@main
    with:
      java-version: ${{ needs.prepare.outputs.java-version }}

  docker:
    needs: [prepare, build]
    if: ${{ needs.prepare.outputs.should-skip == 'false' }}
    uses: now-start/workflow/.github/workflows/reusable-java-docker.yaml@main
    with:
      service-name: ${{ inputs.service-name }}
      registry-org: ${{ inputs.registry-org }}
      environment: ${{ inputs.environment }}
      version: ${{ needs.prepare.outputs.version }}
      java-version: ${{ needs.prepare.outputs.java-version }}
    secrets:
      registry-password: ${{ secrets.registry-password }}
